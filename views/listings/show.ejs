<% layout("/layouts/boilerplate") %>

  <style>
    .weather-container {
      background-color: rgba(255, 255, 255, 0.1);
      /* Glassmorphism effect - more transparent*/
      background-image: url('https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?q=80&w=1935&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
      background-size: cover;
      border-radius: 15px;
      /* Slightly more rounded corners */
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
      /* Stronger shadow */
      padding: 25px;
      text-align: center;
      width: 80%;
      /* Slightly wider */
      max-width: 450px;
      /* Reduced max-width for a more compact card */
      backdrop-filter: blur(10px);
      /* Add blur to the background, stronger blur */
      border: 1px solid rgba(255, 255, 255, 0.2);
      /* Add a border */
    }

    .main-weather {
      display: flex !important;
      flex-wrap: wrap;
      flex-direction: row !important;
      /* justify-content: center; */
      align-items: center;
    }

    .about-weather {
      height: 30rem;
      width: 40rem;
      padding: 3rem;
      border: none !important;
    }

    h1 {
      color: #fff;
      /* White text */
      margin-bottom: 5px;
      /* Reduced margin */
      font-size: 1.8em;
      /* Slightly smaller heading */
    }

    h2 {
      color: #eee;
      /* Slightly lighter secondary text */
      margin-top: 0;
      font-size: 1.2em;
      font-weight: normal;
      /* Lighter font weight */
    }

    .location-info {
      margin-bottom: 15px;
      /* Reduced margin */
      color: #ddd;
    }

    .weather-icon {
      width: 90px;
      /* Larger icon */
      height: 90px;
      margin-bottom: 10px;
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
      /* Add a shadow to the icon*/
    }

    .temperature {
      font-size: 3em;
      /* Larger temperature */
      color: #fff;
      margin-bottom: 5px;
      /* Reduced margin */
      font-weight: bold;
      /* Make temperature bold */
    }

    .condition {
      color: #fff;
      margin-bottom: 20px;
      /* Increased margin */
      font-size: 1.1em;
    }

    .details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      /* Two columns, equal width */
      gap: 15px;
      /* Increased gap */
      text-align: left;
      color: #fff;
      margin-top: 25px;
      /* Increased margin */
    }

    .detail-item {
      padding: 12px;
      /* Increased padding */
      border-radius: 10px;
      /* More rounded corners */
      background-color: rgba(255, 255, 255, 0.1);
      /* Glassmorphism for details */
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .detail-item strong {
      color: #fff;
      /* Strong color */
      font-weight: bold;
    }

    .weather-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 15px;
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      /* Gradient Overlay */
      z-index: -1;
    }

    .booking-btn {
      /* width: 25rem !important; */
      padding: 0.5rem !important;
      height: 3rem !important;
    }

    .booking-btn:hover {
      background-color: #fe424d !important;
      border: none !important;
    }

    .review-container {
      background-color: #ddd;
      padding: 1rem 3rem 1rem 1rem;
      border-radius: 7px;
    }

    .review-card {
      background-color: #ddd;
      min-height: 5rem !important;
      min-width: auto !important;
    }
    .img-div{
      display:grid;
      grid-template-columns: 2fr 1fr;
      gap:5px;
    }
    #hotel-img{
      grid-row-start: 1;
      grid-row-end: 3;
    }
  </style>

  <script>
    const coordinates = <%= JSON.stringify(listing.coordinates) %>;
  </script>

  <body>
    <div class="row">
      <div class="col-8 offset-2">
        <div class="card show-card offset-0 col-12">
          <div class="offset-0 col-12 img-div">
            <img src="<%= listing.image.url %>" class="card-img-top" alt="listing image" class="show-image" id="hotel-img">
            <img src="https://plus.unsplash.com/premium_photo-1661877303180-19a028c21048?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="card-img-top" alt="listing image" class="show-image">
            <img src="https://images.unsplash.com/photo-1534612899740-55c821a90129?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="card-img-top" alt="listing image" class="show-image">
          </div>
          <div class="card-body">
            <h3 class="fs-1 mt-2">
              <b>
                <%= listing.title.toUpperCase() %>
              </b>
            </h3>
            <p>Owned By: <b><%= listing.owner.username %></b> 
            </p>
            <p class="card-text">
              <%=[listing.description]%>
            </p>
            <p><b> &#8377 <%= listing.price ? listing.price.toLocaleString("en-IN") : "Price not available" %>/night</b></p>
            <p>
              <b><%=listing.location%></b>
            </p>
            <p>
              <b><%=listing.country%></b>
            </p>
          </div>
        </div>

      </div>
      <%if(currUser && listing.owner._id.equals(currUser._id)){%>
        <div class="btns mb-3 offset-2">
          <a href="/listings/<%= listing._id %>/edit" class="btn btn-dark ms-2">Edit</a>

          <form action="/listings/<%= listing._id %>?_method=DELETE" method="post">
            <button class="btn btn-dark">Delete</button>
          </form>
        </div>
        <% } %>

          <%if(currUser){%>
            <div class="col-8 offset-2 mb-3">
              <form action="/listings/booking/<%= listing._id %>" method="post">
                <button class="btn btn-dark booking-btn offset-4">Book Now</button>
              </form>
              <hr>
              <div class="review-container">
                <h4><b>Add A Review</b></h4>
                <form action="/listings/<%= listing._id %>/reviews" method="post" novalidate class="needs-validation">
                  <label for="rating" class="form-label ms-3">Give Rating</label>
                  <fieldset class="starability-slot ms-3">
                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked
                      aria-label="No rating." />
                    <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                    <label for="first-rate1" title="Terrible">1 star</label>
                    <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                    <label for="first-rate2" title="Not good">2 stars</label>
                    <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                    <label for="first-rate3" title="Average">3 stars</label>
                    <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                    <label for="first-rate4" title="Very good">4 stars</label>
                    <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                    <label for="first-rate5" title="Amazing">5 stars</label>
                  </fieldset>
                  <div>
                    <label for="comment" class="ms-3">Comment</label>
                    <textarea name="review[comment]" id="comment" rows="3" class="form-control ms-3"
                      placeholder="Write Your Experience....." required></textarea>
                    <div class="invalid-feedback">Please enter the comment</div>
                  </div>
                  <button class="btn btn-dark ms-3 mt-2">Add</button>
                </form>
              </div>
            </div>
            <% } %>
    </div>
    <% if(listing.review.length> 0) {%>
      <div class="row offset-2">
        <h4><b>All Reviews</b></h4>
        <% for (rew of listing.review) { %>
          <div class="card mb-2 ms-1 col-8 review-card">
            <div class="card-body">
              <h5 class="card-title"><b>
                  <%= rew.author.username.toUpperCase() %>
                </b> </h5>
              </p>
              <p class="starability-result" data-rating="<%= rew.rating %>"></p>
              <p class="card-text mt-2" style="font-size: 15px;">
                <%= rew.comment %>
              </p>
            </div>
            <form action="/listings/<%= listing._id %>/reviews/<%= rew._id %>?_method=DELETE" method="POST">
              <button class="btn mb-3 ms-3 btn-dark">Delete</button>
            </form>
          </div>
          <% } %>
      </div>
      <% } %>
        <div class="main-weather">
          <div class="weather-container offset-2 mb-3 mt-3">
            <div>
              <h1>Weather in <%= weatherData.location.name %>
              </h1>
              <div class="location-info">
                <h2>
                  <%= weatherData.location.region %>
                </h2>
              </div>

              <img src="<%= weatherData.current.condition.icon %>" alt="<%= weatherData.current.condition.text %>"
                class="weather-icon">
              <p class="temperature">
                <%= weatherData.current.temp_c %>°C / <%= weatherData.current.temp_f %>°F
              </p>
              <p class="condition">
                <%= weatherData.current.condition.text %>
              </p>

              <div class="details">
                <div class="detail-item"><strong>Wind:</strong>
                  <%= weatherData.current.wind_mph %> mph (<%= weatherData.current.wind_kph %> kph)
                </div>
                <div class="detail-item"><strong>Direction:</strong>
                  <%= weatherData.current.wind_dir %>
                </div>
                <div class="detail-item"><strong>Humidity:</strong>
                  <%= weatherData.current.humidity %>%
                </div>
              </div>
            </div>
          </div>
          <div class="about-weather card">
            <h3 class="fs-1"><b>Live Weather Updates</b></h3>
            <p class="fs-6">Planning your trip just got easier! Our Live Weather Info section provides real-time updates
              on the
              current
              weather conditions at your chosen destination. Whether you’re booking a tropical getaway or a mountain
              retreat, we’ll keep you informed about:
            </p>
            <ul class="fs-6">
              <li>Current temperature</li>
              <li>Humidity levels</li>
              <li>Chance of rain or sunshine</li>
              <li>Wind speed and direction</li>
            </ul>
          </div>
        </div>

        <h3 class="col-6 offset-2 mb-3">Where You'll be</h3>

        <div id="map" style="width: 70%; height: 500px" class="offset-2"></div>

        <script>
          // console.log(coordinates);
          const map = new maplibregl.Map({
            style: 'https://tiles.openfreemap.org/styles/liberty',
            center: coordinates,
            zoom: 9.5,
            container: 'map',
          })
        </script>
        <br>
  </body>